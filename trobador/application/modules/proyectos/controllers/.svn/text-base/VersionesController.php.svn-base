<?php

class Proyectos_VersionesController extends Zend_Controller_Action
{

    protected $_tablaVersiones = null;

    public function init()
    {
        $this->_tablaVersiones= new Proyectos_Model_DbTable_Versions();
    }

    // Formulario que permite crear una versión dentro de un proyecto
    public function crearversionAction()
    {

        $this->view->headTitle("Nova version");
        $mensaje="";

        $formularioNuevaVersion = new Proyectos_Form_Nuevaversion();
        $formularioNuevaVersion->setAction('crearversion');
        $formularioNuevaVersion->setMethod('post');

        //Si se reciben datos por post
        if($this->getRequest()->isPost()){
            //Si los datos recibidos son válidos
            if($formularioNuevaVersion->isValid($_POST)){

                $data=$formularioNuevaVersion->getValues();


                if($this->_tablaVersiones->existeVersion($data['nombreVersion'], $data['proyecto'])==false){

                    $auth=Zend_Auth::getInstance();
                    $userData = $auth->getStorage()->read();
                    $this->_tablaVersiones->almacenarVersion($data['nombreVersion'], $userData['user_id'], $data['proyecto']);

                    $mensaje = "version creada";

                }else{
                    $mensaje = "la version ya existe";
                }
            }
        }

        $this->view->form=$formularioNuevaVersion;
        $this->view->mensaje=$mensaje;
    }

    // Borra una versión
    public function eliminarversionAction()
    {
        $mensaje="";
       // Si se reciben datos por get
        if($this->getRequest()->isGet()){

            $idVersion=$this->getRequest()->getParam("idVersion");
            
            $this->_tablaVersiones->eliminarVersion($idVersion);
            $mensaje="Versión eliminada con éxito";

        }
        $this->view->mensaje=$mensaje;
    }

    // Borra las versiones de un proyecto
    public function eliminarversionesAction()
    {
        if($this->getRequest()->isGet()) {
            $idProyecto=$this->getRequest()->getParam("idProyecto");

            $this->_tablaVersiones->eliminarVersiones($idProyecto);
        }
    }

    // Permite ver los detalles de una versión @todo
    public function verversionAction()
    {
        // action body
    }

    


}







